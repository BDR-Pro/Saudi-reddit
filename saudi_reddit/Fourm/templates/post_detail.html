{% extends 'base.html' %}

{% block title %}
    {{ post.title }}
{% endblock %}

{% block content %}
    <a href="{% url 'subreddit:subreddit_detail' subreddit.slug %}">{{ subreddit.name }}</a>
    <h1>{{ post.title }}</h1>
    <h6>
        Posted by:
        <a href="{% url 'User:profile_with_username' username=post.author.username %}">
            {{ post.author.username }}
        </a>
        | {{ post.created_at|date:"F j, Y, g:i a" }}
    </h6>

    <p>{{ post.content }}</p>

    {% if post.image %}
        <div class="image-overlay">
            <img src="{{ post.image.url }}" alt="{{ post.title }} Image" class="post-image">
            <div class="overlay-text"></div>
        </div>
    {% endif %}

    {% if post.video %}
        <video controls>
            <source src="{{ post.video.url }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    {% endif %}

    <p>
        Author: <a href="{% url 'User:profile_with_username' username=post.author.username %}">{{ post.author.username }}</a> | Votes: {{ post.votes }} | Views: {{ post.views }}
    </p>
    {% if user.is_authenticated %}
    <a href="{% url 'Fourm:upvote_post' post.slug %}" class="vote-button">
        <span class="material-icons-outlined"></span>
        Upvote
    </a>
    <a href="{% url 'Fourm:downvote_post' post.slug %}" class="vote-button">
        <span class="material-icons-outlined"></span>
        Downvote
    </a>
    
    {% if user == post.author %}
        <a href="{% url 'Fourm:delete_post' post.slug %}" class="delete-button">
            <span class="material-icons-outlined"></span>
            Delete
        </a>
    {% endif %}
{% endif %}
    <a href="{% url 'subreddit:subreddit_detail' subreddit.slug %}" class="vote-button">Back to {{ subreddit.name }}</a>

    <h2>Comments</h2>
    <div class="comments-section">
        {% for comment in comments %}
            <div class="comment">
                <p class="comment-content">{{ comment.content }}</p>
                <a href="{% url 'User:profile_with_username' username=comment.author.username %}" class="comment-author">{{ comment.author.username }} | Votes: {{ comment.votes }}</a>
                {{ comment.created_at|date:"F j, Y, g:i a" }}
                {% if comment.isContentEdited %}
                    | Edited: {{ comment.whenContentEdited|date:"F j, Y, g:i a" }}
                {% endif %}

                {% if comment.image %}
                    <div class="image-overlay">
                        <img src="{{ comment.image.url }}" alt="{{ comment.title }} Image" class="post-image">
                        <div class="overlay-text">View Image</div>
                    </div>
                {% endif %}

                {% if comment.video %}
                    <video controls>
                        <source src="{{ comment.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                {% endif %}

                {% if user.is_authenticated %}

                <div class="comment-actions">
                    <a href="{% url 'Fourm:upvote_comment' comment.slug %}" class="vote-button {% if request.user.is_authenticated and request.user in comment.upvoters.all %}upvoted{% endif %}">
                        <span class="material-symbols-outlined">
                            arrow_upward
                        </span>
                    </a>
                    
                    <a href="{% url 'Fourm:downvote_comment' comment.slug %}" class="vote-button {% if request.user.is_authenticated and request.user in comment.downvoters.all %}downvoted{% endif %}">
                        <span class="material-symbols-outlined">
                            arrow_downward
                        </span>
                    </a>

                    {% if user.is_authenticated and user == comment.author %}

                    
                    <a href="{% url 'Fourm:update_comment' comment.slug %}" class="edit-button">
                        <span class="material-symbols-outlined">
                            edit
                        </span>
                    </a>
                    {% endif %}
                    {% if user.is_authenticated and user == comment.author %}
                        <a href="{% url 'Fourm:delete_comment' comment.slug %}" class="delete-button">
                            <span class="material-symbols-outlined">
                                delete_forever
                            </span>
                        </a>
                    {% else %}
                        <a href="{% url 'subreddit:comment_reply' comment.slug %}" class="reply-button">
                            <span class="material-symbols-outlined">
                                reply
                            </span>
                        </a>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    {% if user.is_authenticated %}
        <h3>Add a Comment</h3>
        <div class="add-comment-section">
            <form method="post" action="{% url 'Fourm:add_comment' post.slug %}" class="comment-form">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Add Comment" class="submit-button">
            </form>
        </div>
    {% else %}
        <p><a href="{% url 'User:login' %}" class="login-link">Log in</a> to leave a comment.</p>
    {% endif %}

{% endblock %}

{% block style %}
<style>
    .comment-form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
    }

    /* Global Styles */
    body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f8f9fa; /* Bootstrap background color */
        color: #495057; /* Bootstrap text color */
    }

    .container {
        margin-top: 20px;
    }

    /* Header Styles */
    h1 {
        color: #343a40; /* Bootstrap dark color */
        margin-bottom: 20px;
    }

    /* Post Content Styles */
    .post-content {
        line-height: 1.6;
        margin-bottom: 20px;
    }

    /* Image Styles */
    .post-image {
        max-width: 100%;
        height: auto;
        margin-bottom: 20px;
        border-radius: 8px; /* Optional: Adds rounded corners to the image */
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Optional: Adds a subtle shadow to the image */
    }

    .image-overlay {
        position: relative;
    }

    .overlay-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #ffffff;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .image-overlay:hover .overlay-text {
        opacity: 1;
    }

    /* Comments Styles */
    .comments-section {
        margin-top: 30px;
    }

    .comment {
        border: 1px solid #ced4da; /* Bootstrap gray border color */
        padding: 15px;
        margin-bottom: 20px;
    }

    .comment-content {
        margin-bottom: 10px;
    }

    .comment-author {
        font-size: 14px;
        color: #868e96; /* Bootstrap secondary color */
    }

    .comment-actions {
        margin-top: 10px;
    }

    .comment-actions a {
        color: #000000; /* Bootstrap primary color */
        text-decoration: none;
        margin-right: 10px;
    }

    .comment-actions a:hover {
        text-decoration: underline;
    }

    /* Add Comment Section Styles */
    .add-comment-section {
        margin-top: 30px;
    }

    .comment-form {
        margin-top: 15px;
    }

    .comment-form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
    }

    /* Custom styles for upvoted and downvoted buttons */
    .vote-button.upvoted {
        color: green;
    }

    .vote-button.downvoted {
        color: red;
    }
</style>
{% endblock %}
